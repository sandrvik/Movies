(()=>{"use strict";const e=document.getElementById("popup"),t=document.getElementById("popup__image"),n=document.getElementById("popup__title"),a=document.getElementById("popup__lang"),o=document.getElementById("popup__year"),s=document.getElementById("popup__description"),i=document.getElementById("popup__genres"),l=document.getElementById("overlay");function c(){e.classList.toggle("active"),l.classList.toggle("active"),document.body.classList.toggle("lock")}function d(e){!function(e){const l=e.parentNode;t.innerHTML=`<img src=${l.info.image?.medium||l.info.image?.original||"./assets/images/noImageAvailable.jpg"}>`,n.innerText=l.info.name,a.innerText=l.info.language,o.innerText=l.info.premiered?.slice(0,4)||"Sometime",s.innerHTML=l.info.summary||"No description available.",i.innerHTML="",l.info.genres.forEach((e=>{const t=document.createElement("li");t.innerText=e,i.append(t)}))}(e.target),c()}e.addEventListener("click",(function(e){e.target.closest(".popup__container")&&!e.target.classList.contains("popup__close")||c()}));const r=document.getElementById("movies");function m(e){if(movies.innerHTML="",0===e.length||0===e.size){const e=document.createElement("h2");e.innerText="Films not found",movies.append(e)}else e.forEach((e=>function(e){const t=document.createElement("li");t.setAttribute("class","card"),t.setAttribute("data-id",e.id),t.info=e;const n=document.createElement("img");n.setAttribute("class","card__img"),n.style.width="200px",n.style.height="280px",n.src=e.image?.medium||"./assets/images/noImageAvailable.jpg",n.addEventListener("click",d);const a=document.createElement("img");a.setAttribute("class","card__heart"),f.has(`${e.id}`)?a.src="./assets/icomoon/SVG/heart.svg":a.src="./assets/icomoon/SVG/heart-outlined.svg",t.append(n),t.append(a),r.appendChild(t)}(e)))}const u=document.getElementById("header"),g=document.getElementById("main"),p=document.getElementById("pagination"),y=document.getElementById("search"),E=document.getElementById("favouritesHeader");let f;function v(){u.style.display="block",g.style.display="block",p.style.display="none",y.style.display="none",E.style.display="block";const e=document.getElementsByClassName("filters__select");for(let t of e)t.disabled=!0;m(f)}f=localStorage.getItem("favs")?new Map(JSON.parse(localStorage.getItem("favs"))):new Map;const h=function(e,t,n){return function(e){if(e.target.classList.contains("card__heart")){const a=e.target.parentNode.dataset.id,o=e.target.parentNode.info;t.has(a)?(t.delete(a),_(t,n),e.target.src="./assets/icomoon/SVG/heart-outlined.svg"):(t.set(a,o),e.target.src="./assets/icomoon/SVG/heart.svg",_(t,n))}}}(0,f,"favs");function _(e,t){localStorage.setItem(t,JSON.stringify([...e]))}document.addEventListener("click",h);const B="https://api.tvmaze.com/";async function I(e,t){try{const n=await fetch(e);return((e,t)=>e.map((e=>((e,...t)=>{const n=t.filter((t=>t in e)).map((t=>[t,e[t]]));return Object.fromEntries(n)})(e.show||e._embedded?.show||e,...t))))((await n.json()).slice(0,t),["language","genres","name","image","summary","premiered","id"])}catch(e){console.log("Error:",e)}}const L=document.getElementById("lang"),b=document.getElementById("genre");function k(e){const t={language:L.value,genres:b.value},n=Object.keys(t);return e.filter((e=>n.every((n=>!t[n]||t[n]===e[n]||e[n].includes(t[n])))))}const x=document.getElementById("currentPage"),w=document.getElementById("lastPage"),T=document.getElementById("prev"),N=document.getElementById("next"),S=document.getElementById("paginationDropDown"),$=document.getElementById("expandDropDown");let F=1;document.body.addEventListener("click",(()=>{S.classList.contains("pagination__full--hidden")||S.classList.toggle("pagination__full--hidden")})),x.innerText=F,w.innerText=10,w.addEventListener("click",(()=>{F=10,x.innerText=F,V()})),T.addEventListener("click",(()=>{1!==F&&(F-=1,x.innerText=F,V())})),N.addEventListener("click",(()=>{10!==F&&(F+=1,x.innerText=F,V())})),function(e){for(let e=1;e<=10;e++){const t=document.createElement("li");t.classList.add("pagination__page"),t.innerText=e,t.addEventListener("click",(e=>{F=+e.target.innerText,x.innerText=F,V(),S.classList.toggle("pagination__full--hidden")})),S.append(t)}$.addEventListener("click",(e=>{e.stopPropagation(),S.classList.toggle("pagination__full--hidden")}))}();const H=document.getElementById("header"),j=document.getElementById("main"),A=document.getElementById("pagination"),C=document.getElementById("loginForm"),D=document.getElementById("perPage"),M=document.getElementById("search"),O=document.getElementById("favouritesHeader");let P,G;async function V(){location.hash="#/",H.style.display="block",j.style.display="block",C.style.display="none",P=await I(`${B}shows?page=${F-1}`,50),G=k(P),m(G.slice(0,D.value)),A.style.display="block",D.style.display="inline",M.style.display="flex",O.style.display="none";const e=document.getElementsByClassName("filters__select");for(let t of e)t.disabled=!1;L.addEventListener("change",(()=>{G=k(P),m(G.slice(0,D.value))})),b.addEventListener("change",(()=>{G=k(P),m(G.slice(0,D.value))}))}D.addEventListener("change",(()=>{m(G.slice(0,D.value))}));const z=document.getElementById("loginForm"),J=document.getElementById("name"),q=document.getElementById("pass"),R=document.getElementById("loginBtn"),K=document.getElementById("logoutBtn"),Q=document.getElementById("main"),U=document.getElementById("header"),W={admin:"123456",test:"test1234"};function X(e){const t=document.createElement("div");return t.classList.add("form__error"),t.innerText=`This field must contain over ${e-1} symbols`,function(n){n.target.value.length<e?n.target.after(t):t.remove()}}function Y(e,t,n,a){return function(o){o.target.value.length>=e?t[a]=!0:t[a]=!1,Object.values(t).every((e=>e))?n.disabled=!1:n.disabled=!0}}K.addEventListener("click",(function(e){e.preventDefault(),document.cookie="login=true;max-age=0",Q.innerText="",location.hash="#/",location.reload()})),R.addEventListener("click",(function(e){e.preventDefault(),W[J.value]&&q.value===W[J.value]?(document.cookie="login=true;max-age=3600",z.style.display="none",ge()):console.log("Invalid credentials")})),function(e,t){t.disabled=!0;const n={};for(let a in e){n[a]=!1;const o=X(e[a]),s=Y(e[a],n,t,a);document.getElementById(a).addEventListener("keyup",(e=>{o(e),s(e)}))}}({name:4,pass:6},R);const Z=document.getElementById("search"),ee=document.getElementById("perPage"),te=document.getElementById("pagination"),ne=document.getElementById("searchField"),ae=document.getElementById("searchButton"),oe=document.getElementById("favouritesHeader");let se,ie;async function le(){if(ne.value){se=await I(`${B}search/shows?q=${ne.value}`,50),ie=k(se),m(ie),te.style.display="none",ee.style.display="none",Z.style.display="flex",oe.style.display="none";const e=document.getElementsByClassName("filters__select");for(let t of e)t.disabled=!1;L.addEventListener("change",(()=>{ie=k(se),m(ie)})),b.addEventListener("change",(()=>{ie=k(se),m(ie)}))}else V()}let ce=(de="#/search",re=le,function(){location.hash===de?re():location.hash=de});var de,re;function me(e){document.cookie.includes("login=true")?e():(z.style.display="block",U.style.display="none",Q.style.display="none")}ae.addEventListener("click",ce),ne.addEventListener("keydown",(e=>{"Enter"===e.key&&ce()}));const ue=[{path:"/",component:{render:()=>me(V)}},{path:"/favourites",component:{render:()=>me(v)}},{path:"/search",component:{render:()=>me(le)}}],ge=()=>{const e=location.hash.slice(1).toLowerCase()||"/",{component:t}=((e,t)=>t.find((t=>t.path.match(new RegExp(`^\\${e}$`,"gm"))))||void 0)(e,ue)||{};t.render()};window.addEventListener("hashchange",ge),window.addEventListener("load",ge);const pe={"#/":"Films","#/search":"Films","#/favourites":"Favourites"},ye=document.getElementsByClassName("menu__item");window.addEventListener("hashchange",(()=>{const e=location.hash;for(let t of ye)t.innerText!==pe[e]?t.classList.remove("menu__item--active"):t.classList.add("menu__item--active")})),window.addEventListener("load",(()=>{const e=location.hash;for(let t of ye)t.innerText!==pe[e]?t.classList.remove("menu__item--active"):t.classList.add("menu__item--active")}))})();