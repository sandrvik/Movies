(()=>{"use strict";const e=document.getElementById("popup"),t=document.getElementById("overlay");function n(){e.classList.toggle("active"),t.classList.toggle("active"),document.body.classList.toggle("lock")}function a(e){!function(e){const t=e.parentNode;popup__image.innerHTML=`<img src=${t.info.image?.medium||t.info.image?.original||"./assets/images/noImageAvailable.jpg"}>`,popup__title.innerText=t.info.name,popup__lang.innerText=t.info.language,popup__year.innerText=t.info.premiered?.slice(0,4)||"Sometime",popup__description.innerHTML=t.info.summary||"No description available.",popup__genres.innerHTML="",t.info.genres.forEach((e=>{const t=document.createElement("li");t.innerText=e,popup__genres.append(t)}))}(e.target),n()}e.addEventListener("click",(function(e){e.target.closest(".popup__container")&&!e.target.classList.contains("popup__close")||n()}));const s=document.getElementById("movies");function o(e){if(movies.innerHTML="",0===e.length){const e=document.createElement("h2");e.innerText="Films not found",movies.append(e)}else e.forEach((e=>function(e){const t=document.createElement("li");t.setAttribute("class","card"),t.setAttribute("data-id",e.id),t.info=e;const n=document.createElement("img");n.setAttribute("class","card__img"),n.style.width="200px",n.style.height="280px",n.src=e.image?.medium||"./assets/images/noImageAvailable.jpg",n.addEventListener("click",a);const o=document.createElement("img");o.setAttribute("class","card__heart"),m.has(`${e.id}`)?o.src="./assets/icomoon/SVG/heart.svg":o.src="./assets/icomoon/SVG/heart-outlined.svg",t.append(n),t.append(o),s.appendChild(t)}(e)))}const i=document.getElementById("header"),c=document.getElementById("main"),l=document.getElementById("pagination"),d=document.getElementById("search"),r=document.getElementById("favouritesHeader");let m;m=localStorage.getItem("favs")?new Map(JSON.parse(localStorage.getItem("favs"))):new Map;const u=function(e,t,n){return function(e){if(e.target.classList.contains("card__heart")){const a=e.target.parentNode.dataset.id,s=e.target.parentNode.info;t.has(a)?(t.delete(a),g(t,n),e.target.src="./assets/icomoon/SVG/heart-outlined.svg"):(t.set(a,s),e.target.src="./assets/icomoon/SVG/heart.svg",g(t,n))}}}(0,m,"favs");function g(e,t){localStorage.setItem(t,JSON.stringify([...e]))}document.addEventListener("click",u);const p="https://api.tvmaze.com/";async function y(e,t){try{const n=await fetch(e);return((e,t)=>e.map((e=>((e,...t)=>Object.fromEntries(t.filter((t=>t in e)).map((t=>[t,e[t]]))))(e.show||e._embedded?.show||e,...t))))((await n.json()).slice(0,t),["language","genres","name","image","summary","premiered","id"])}catch(e){console.log("Error:",e)}}const h=document.getElementById("lang"),f=document.getElementById("genre");function v(e){const t={language:h.value,genres:f.value},n=Object.keys(t);return e.filter((e=>n.every((n=>!t[n]||t[n]===e[n]||e[n].includes(t[n])))))}const E=document.getElementById("currentPage"),_=document.getElementById("lastPage"),L=document.getElementById("prev"),B=document.getElementById("next"),I=document.getElementById("paginationDropDown"),b=document.getElementById("expandDropDown");let k=1;document.body.addEventListener("click",(()=>{I.classList.contains("pagination__full--hidden")||I.classList.toggle("pagination__full--hidden")})),E.innerText=k,_.innerText=10,_.addEventListener("click",(()=>{k=10,E.innerText=k,A()})),L.addEventListener("click",(()=>{1!==k&&(k-=1,E.innerText=k,A())})),B.addEventListener("click",(()=>{10!==k&&(k+=1,E.innerText=k,A())})),function(e){for(let e=1;e<=10;e++){const t=document.createElement("li");t.classList.add("pagination__page"),t.innerText=e,t.addEventListener("click",(e=>{k=+e.target.innerText,E.innerText=k,A(),I.classList.toggle("pagination__full--hidden")})),I.append(t)}b.addEventListener("click",(e=>{e.stopPropagation(),I.classList.toggle("pagination__full--hidden")}))}();const x=document.getElementById("header"),w=document.getElementById("main"),T=document.getElementById("pagination"),N=document.getElementById("loginForm"),S=document.getElementById("perPage"),F=document.getElementById("search"),$=document.getElementById("favouritesHeader");let H,j;async function A(){location.hash="#/",x.style.display="block",w.style.display="block",N.style.display="none",H=await y(`${p}shows?page=${k-1}`,50),j=v(H),o(j.slice(0,S.value)),T.style.display="block",S.style.display="inline",F.style.display="flex",$.style.display="none";const e=document.getElementsByClassName("filters__select");for(let t of e)t.disabled=!1;h.addEventListener("change",(()=>{j=v(H),o(j.slice(0,S.value))})),f.addEventListener("change",(()=>{j=v(H),o(j.slice(0,S.value))}))}S.addEventListener("change",(()=>{o(j.slice(0,S.value))}));const C=document.getElementById("loginForm"),D=document.getElementById("name"),M=document.getElementById("pass"),O=document.getElementById("loginBtn"),P=document.getElementById("logoutBtn"),G=document.getElementById("main"),V=document.getElementById("header"),J={admin:"123456",test:"test1234"};function q(){return document.cookie.includes("login=true")}function z(){C.style.display="block",V.style.display="none",G.style.display="none"}function R(e){const t=document.createElement("div");return t.classList.add("form__error"),t.innerText=`This field must contain over ${e-1} symbols`,function(n){n.target.value.length<e?n.target.after(t):t.remove()}}function K(e,t,n,a){return function(s){s.target.value.length>=e?t[a]=!0:t[a]=!1,Object.values(t).every((e=>e))?n.disabled=!1:n.disabled=!0}}P.addEventListener("click",(function(e){e.preventDefault(),document.cookie="login=true;max-age=0",G.innerText="",location.hash="#/",location.reload()})),O.addEventListener("click",(function(e){e.preventDefault(),J[D.value]&&M.value===J[D.value]?(document.cookie="login=true;max-age=3600",C.style.display="none",ne()):console.log("Invalid credentials")})),function(e,t){t.disabled=!0;const n={};for(let a in e){n[a]=!1;const s=R(e[a]),o=K(e[a],n,t,a);document.getElementById(a).addEventListener("keyup",(e=>{s(e),o(e)}))}}({name:4,pass:6},O);const Q=document.getElementById("search"),U=document.getElementById("perPage"),W=document.getElementById("pagination");let X,Y;async function Z(){if(searchField.value){location.hash="#/search",X=await y(`${p}search/shows?q=${searchField.value}`,50),Y=v(X),o(Y),W.style.display="none",U.style.display="none",Q.style.display="flex",favouritesHeader.style.display="none";const e=document.getElementsByClassName("filters__select");for(let t of e)t.disabled=!1;h.addEventListener("change",(()=>{Y=v(X),o(Y)})),f.addEventListener("change",(()=>{Y=v(X),o(Y)}))}else A()}searchButton.addEventListener("click",(async e=>{"#/search"===location.hash?Z():location.hash="#/search"})),searchField.addEventListener("keydown",(e=>{"Enter"===e.key&&("#/search"===location.hash?Z():location.hash="#/search")}));const ee=[{path:"/",component:{render:()=>{q()?A():z()}}},{path:"/favourites",component:{render:()=>{q()?function(){i.style.display="block",c.style.display="block",l.style.display="none",d.style.display="none",r.style.display="block";const e=document.getElementsByClassName("filters__select");for(let t of e)t.disabled=!0;o(m)}():z()}}},{path:"/search",component:{render:()=>{q()?Z():z()}}}],te=()=>{const e=location.hash.slice(1).toLowerCase()||"/",{component:t}=((e,t)=>t.find((t=>t.path.match(new RegExp(`^\\${e}$`,"gm"))))||void 0)(e,ee)||{};t.render()};window.addEventListener("hashchange",te),window.addEventListener("load",te);const ne=te,ae={"#/":"Films","#/search":"Films","#/favourites":"Favourites"},se=document.getElementsByClassName("menu__item");window.addEventListener("hashchange",(()=>{const e=location.hash;for(let t of se)t.innerText!==ae[e]?t.classList.remove("menu__item--active"):t.classList.add("menu__item--active")})),window.addEventListener("load",(()=>{const e=location.hash;for(let t of se)t.innerText!==ae[e]?t.classList.remove("menu__item--active"):t.classList.add("menu__item--active")}))})();